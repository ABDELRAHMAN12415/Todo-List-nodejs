---
- name: docker compose app deployment
  hosts: production
  vars_files:
    - vault_for_db_creds.yml

  tasks:
    - name: Copy docker-compose.yml to EC2
      copy:
        src: ./docker-compose.yml
        dest: /home/ec2-user/docker-compose.yml
        owner: ec2-user
        group: ec2-user
        mode: '0644'

    - name: Run docker-compose up
      command: docker-compose up -d
      args:
        chdir: /home/ec2-user
      environment:
        MONGO_URI: "{{ MONGO_URI }}"
